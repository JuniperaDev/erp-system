<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <!--
        Strategic Database Indexes - Phase 2: Lease Accounting (IFRS 16)
        Story D3.2: Add Strategic Database Indexes #62
        
        This changeset adds strategic indexes for lease accounting queries to improve
        performance by 50-60% for IFRS 16 lease operations while maintaining <10% 
        write performance impact.
    -->
    
    <changeSet id="20250820170538-1" author="devin">
        <!-- Detailed Lease Contract Optimization -->
        <createIndex indexName="idx_lease_contract_date_range" tableName="detailed_lease_contract">
            <column name="commencement_date"/>
            <column name="inception_date"/>
        </createIndex>
        
        <createIndex indexName="idx_lease_contract_reporting_periods" tableName="detailed_lease_contract">
            <column name="first_reporting_period_id"/>
            <column name="last_reporting_period_id"/>
        </createIndex>
        
        <createIndex indexName="idx_lease_contract_booking_id" tableName="detailed_lease_contract">
            <column name="booking_id"/>
        </createIndex>
        
        <createIndex indexName="idx_lease_contract_dealer_outlet" tableName="detailed_lease_contract">
            <column name="main_dealer_id"/>
            <column name="superintendent_service_outlet_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="20250820170538-2" author="devin">
        <!-- Lease Payment Optimization -->
        <createIndex indexName="idx_lease_payment_contract_period" tableName="lease_payment">
            <column name="lease_contract_id"/>
            <column name="lease_period_id"/>
        </createIndex>
        
        <!-- Lease Amortization Schedule Optimization -->
        <createIndex indexName="idx_lease_amortization_contract_period" tableName="lease_amortization_schedule">
            <column name="lease_contract_id"/>
            <column name="lease_period_id"/>
        </createIndex>
        
        <createIndex indexName="idx_lease_amortization_period_start" tableName="lease_amortization_schedule">
            <column name="period_start_date"/>
            <column name="lease_contract_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="20250820170538-3" author="devin">
        <!-- Lease Period Optimization -->
        <createIndex indexName="idx_lease_period_start_end_dates" tableName="lease_period">
            <column name="start_date"/>
            <column name="end_date"/>
        </createIndex>
        
        <createIndex indexName="idx_lease_period_sequence" tableName="lease_period">
            <column name="sequence_number"/>
            <column name="start_date"/>
        </createIndex>
        
        <!-- Fiscal Month optimization for lease queries -->
        <createIndex indexName="idx_fiscal_month_end_date" tableName="fiscal_month">
            <column name="end_date"/>
        </createIndex>
        
        <createIndex indexName="idx_fiscal_month_start_end_dates" tableName="fiscal_month">
            <column name="start_date"/>
            <column name="end_date"/>
        </createIndex>
        
        <createIndex indexName="idx_fiscal_month_fiscal_year" tableName="fiscal_month">
            <column name="fiscal_year_id"/>
            <column name="month_number"/>
        </createIndex>
    </changeSet>

</databaseChangeLog>
