<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd
                        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <!--
        Strategic Database Indexes - Phase 2: Lease Accounting (IFRS 16) - FIXED VERSION
        Story D3.2: Add Strategic Database Indexes #62
        
        This changeset adds strategic indexes for lease accounting queries to improve
        performance by 50-60% for IFRS 16 lease operations while maintaining <10% 
        write performance impact.
        
        FIXED: Corrected column references to match actual database schema
    -->
    
    <changeSet id="20250820172430-2-fixed" author="devin">
        <!-- Lease Payment Optimization -->
        <createIndex indexName="idx_lease_payment_contract_date" tableName="lease_payment">
            <column name="lease_contract_id"/>
            <column name="payment_date"/>
        </createIndex>
        
        <!-- Lease Amortization Schedule Optimization -->
        <createIndex indexName="idx_lease_amortization_contract_liability" tableName="lease_amortization_schedule">
            <column name="lease_contract_id"/>
            <column name="lease_liability_id"/>
        </createIndex>
        
        <createIndex indexName="idx_lease_amortization_identifier" tableName="lease_amortization_schedule">
            <column name="identifier"/>
            <column name="lease_contract_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="20250820172430-3-fixed" author="devin">
        <!-- Lease Period Optimization -->
        <createIndex indexName="idx_lease_period_start_end_dates" tableName="lease_period">
            <column name="start_date"/>
            <column name="end_date"/>
        </createIndex>
        
        <createIndex indexName="idx_lease_period_sequence" tableName="lease_period">
            <column name="sequence_number"/>
            <column name="start_date"/>
        </createIndex>
        
        <!-- Fiscal Month optimization for lease queries -->
        <createIndex indexName="idx_fiscal_month_end_date" tableName="fiscal_month">
            <column name="end_date"/>
        </createIndex>
        
        <createIndex indexName="idx_fiscal_month_start_end_dates" tableName="fiscal_month">
            <column name="start_date"/>
            <column name="end_date"/>
        </createIndex>
        
        <createIndex indexName="idx_fiscal_month_fiscal_year" tableName="fiscal_month">
            <column name="fiscal_year_id"/>
            <column name="month_number"/>
        </createIndex>
    </changeSet>

</databaseChangeLog>
